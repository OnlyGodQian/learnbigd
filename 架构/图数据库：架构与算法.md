# 图数据库：架构与算法

## 在线查询类图数据库

### 三层结构

在线查询类图数据库的主要目的往往是给具体应用提供在线数据读写服务，其中尤其关注数据查询类服务，所以更强调系统的高可用性和读写的低延迟。其体系结构一般由底向上可以划分为三层：分布式存储引擎层、图数据管理层和最上端的图操作API层。

业界比较知名的在线查询类图数据库包括Twitter的FlockDB和Facebook的TAO，这两者的架构基本符合上述三层体系。

## 常见图挖掘问题

### PageRank计算

对于网页A来说，该网页PageRank的计算基于以下两个基本假设：

* 数量假设：在Web图模型中，如果一个页面节点接收到其他网页指向的入链数量越多，那么这个页面越重要。
* 质量假设：指向页面A的入链质量不同，质量高的页面会通过链接向其他页面传递更多的权重。所以质量越高的页面指向A，则A越重要。

### 单源最短路径（Single Source Shorttest Path）

求图节点之间的最短路径是一个经典的图计算问题，现实生活中很多应用都可以映射到这个问题上，比如，社交网络上的六度空间理论。

单源最短路径是众多最短路径问题中的一种：指定源节点startV后，求startV到图中其他任意节点的最短路径。

### 二部图最大匹配

二部图是这样一个图G(V,E)：其图节点V可以划分为两个集合Vx和Vy，图中任意边e∈E连接的两个顶点恰好一个在Vx，一个在Vy中。所谓二部图的匹配，指的是二部图G的一个子图M，M中的任意两条边都不依附于同一个节点。而最大匹配即是指边数最多的那个二部图匹配。

##离线挖掘数据分片

###切边法（Edge-Cut）

###切点法（Vertex-Cut）

##离线挖掘计算模型

对于离线挖掘类图计算而言，目前已经涌现出众多各方面表现优秀而各具特点的实际系统，典型的比如Pregel、Giraph、Hama、PowerGraph、GraphLab、GraphChi等。

###以节点为中心的编程模型

Vertex-Centered Programming Model

首先由Pregel系统提出，之后的绝大多数离线挖掘类大规模图计算系统都采用这个模型作为编程模型

###GAS编程模型

可以看做是对节点为中心的图计算编程模型的一种细粒度改造，通过将计算过程进一步细分来增加计算并发性。

###同步执行模型

同步执行模型是相对于异步执行模型而言的。

我们知道，图计算往往需要经过多轮迭代过程，在以节点为中心的图编程模型下，在每轮迭代过程中对图节点会调用用户自定义函数Function(vertex)，这个函数会更改vertex节点及其对应边的状态，如果节点的这种状态变化在本轮迭代过程中就可以被其他节点看到并使用，也就是说变化立即可见，那么这种模式被称为异步执行模型；如果所有的状态变化只有等到下一轮迭代才可见并允许使用，那么这种模式被称为同步执行模型。采用同步执行模型的系统在迭代过程中或者连续两轮迭代过程之间往往存在一个同步点，同步点的目的在于保证每个节点都已经接受到本轮迭代更新后的状态信息，以保证可以进入下一轮的迭代过程。

在实际的系统中，两种典型的同步执行模型包括BSP模型和MapReduce模型。

###异步执行模型

异步执行模型相对于同步执行模型而言，因为不需要进行数据同步，而且更新的数据能够在本轮迭代即可被使用，所以算法收敛速度快，系统吞吐量和执行效率都要明显高于同步模型。但是异步模型也有相应的缺点：其很难推断程序的正确性。因为其数据更新立即生效，所以节点的不同执行顺序很可能会导致不同的运行结果，尤其是对图节点并发更新计算的时候，还可能产生争用状况（Race Condition）和数据不一致的问题，所以其在系统实现的时候必须考虑如何避免这些问题，系统实现机制较同步模型复杂。

## 离线挖掘图数据库

### Pregel

是Google提出的大规模分布式图计算平台，专门用来解决网页链接分析、社交数据挖掘等实际应用中涉及的大规模分布式图计算问题。

#### 计算模型

#### 系统架构

主从结构

#### Pregel应用

* PageRank计算
* 单源最短路径
* 二部图最大匹配

### Giraph

是用于大规模图计算的Hadoop开源框架，在计算机指和体系结构上，Giraph基本可以看做是Pregel的开源版本，绝大部分机制和架构与Pregel类似，也是采取BSP计算模型，采用以节点为中心的编程模型，并通过消息传递方式将多轮超级步运算串接起来。

### GraphChi

是GrapLab实验室推出的单机版大规模图计算系统，虽然没有采取目前常用的分布式架构，但是其运算效率及大规模数据处理能力却毫不逊色于采用并行架构的图计算系统。

### PowerGraph

是一个非常值得关注的系统，其无论在图计算的理论分析方面还是实际的系统实施方面都达到了相当的高度，实际效果也表明PowerGraph基本上是目前主流图计算系统里效率最高的。